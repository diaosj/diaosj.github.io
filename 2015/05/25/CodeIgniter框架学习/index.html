<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>CodeIgniter框架学习 | 山中日月长，云下饭藿香</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">CodeIgniter框架学习</h1><a id="logo" href="/.">山中日月长，云下饭藿香</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">CodeIgniter框架学习</h1><div class="post-meta">May 25, 2015</div><div class="post-content"><p>离开前东家之后就挺背的，Paperwhite屏幕被挤裂，Surface Pro蓝屏，QQ、微信都被冻结，球衣球鞋弄丢了，折腾信用卡，折腾保险，连Mac上搭开发环境都搭得七窍生烟，更不要提C++被鄙视，面谈被误解。两周过得跟几个月似的。新东家用的是CodeIgniter框架，版本号2.2.0。一周来在各种培训与杂事之间抽空学习了框架的官方文档，完成了几个简单的功能。框架还不太熟，记了一些笔记在这里，希望能尽快用熟。</p>
<a id="more"></a>
<p>#MVC<br>以前用得比较熟的还是Yii框架。不过既然都是MVC框架，总有不少可以类比的地方。MVC框架里面Controller扮演的是交通枢纽的作用，可以载入libraries，可以载入views，可以操作整个框架。</p>
<p>#工作过程</p>
<p>请求过来时，先进入index.php文件，这是整个系统的入口。在index.php中，先设置应用程序的文件夹名称为application，系统的文件夹名称为system，定义APPPATH，BASEPATH，最后引入codeigniter/codeigniter.php文件。</p>
<p>在codeigniter.php中，require了几个文件：Common.php用于使用一些常用的函数，如load_class、log_message、show_404等；constants.php是一些文件权限的常量。然后用load_class()载入类库：Benchmark、Hooks、Config、Utf8、URI、Router等等。最后require了core/Controller.php文件，并调用CI_Controller::get_instance()得到一个实例。然后根据Router解析请求。</p>
<p>#form<br>CodeIgniter提供了比较实用的表单写法，如下所示。</p>
<p>##View层</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;?php echo validation_errors();?&gt;</div><div class="line">&lt;?php echo form_open('news/create');?&gt;</div><div class="line">...</div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<p>注意到页面文件中用的是form_open()方法，而不是手写form标签。这是因为CodeIgniter框架在这个方法中顺带做了一些其它的事，比如加入了一个防CSRF的隐藏字段。</p>
<p>##Controller层<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">$this</span>-&gt;load-&gt;helper(<span class="string">'form'</span>);</div><div class="line"><span class="keyword">$this</span>-&gt;load-&gt;library(<span class="string">'form_validation'</span>);</div><div class="line"><span class="keyword">$this</span>-&gt;form_validation-&gt;set_rules(<span class="string">'title'</span>, <span class="string">'Title'</span>, <span class="string">'required'</span>);</div><div class="line"></div><div class="line"><span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;form_validation-&gt;run() === <span class="keyword">FALSE</span>)</div><div class="line">&#123;</div><div class="line">    <span class="comment">//...</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">$this</span>-&gt;news_model-&gt;set_news();</div><div class="line">    <span class="keyword">$this</span>-&gt;load-&gt;view(<span class="string">'news/success'</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注意下设定校验规则的写法：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">$this</span>-&gt;form_validation-&gt;set_rules(</div><div class="line">    <span class="string">'username'</span>, <span class="string">'Username'</span>,</div><div class="line">    <span class="string">'required | min_length[5] | max_length[12] | is_unique[users.username]'</span>,</div><div class="line">    <span class="keyword">array</span>(</div><div class="line">        <span class="string">'required'</span>  =&gt; <span class="string">'You have not provided %s'</span>,</div><div class="line">        <span class="string">'is_unique'</span> =&gt; <span class="string">'This %s already exists.'</span></div><div class="line">    )</div><div class="line">);</div><div class="line"><span class="keyword">$this</span>-&gt;form_validation-&gt;set_rules(<span class="string">'password'</span>, <span class="string">'Password'</span>, <span class="string">'required'</span>);</div><div class="line"><span class="keyword">$this</span>-&gt;form_validation-&gt;set_rules(<span class="string">'passconf'</span>, <span class="string">'Password Confirmation'</span>, <span class="string">'required | matches[password]'</span>);</div><div class="line"><span class="keyword">$this</span>-&gt;form_validation-&gt;set_rules(<span class="string">'email'</span>, <span class="string">'Email'</span>, <span class="string">'required | valid_email | is_unique[users.email]'</span>);</div></pre></td></tr></table></figure></p>
<p>所有PHP原生函数都可以拿来做校验的规则：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">$this</span>-&gt;form_validation-&gt;set_rules(<span class="string">'password'</span>, <span class="string">'Password'</span>, <span class="string">'trim | required | md5'</span>);</div></pre></td></tr></table></figure></p>
<p>##Model层<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set_news</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">$this</span>-&gt;load-&gt;helper(<span class="string">'url'</span>);</div><div class="line">    $slug = url_title(<span class="keyword">$this</span>-&gt;input-&gt;post(<span class="string">'title'</span>), <span class="string">'dash'</span>, <span class="keyword">TRUE</span>);</div><div class="line">    $data = <span class="keyword">array</span>(</div><div class="line">        <span class="string">'title'</span> =&gt; <span class="keyword">$this</span>-&gt;input-&gt;post(<span class="string">'title'</span>),</div><div class="line">        <span class="string">'slug'</span>  =&gt; $slug,</div><div class="line">        <span class="string">'text'</span>  =&gt; <span class="keyword">$this</span>-&gt;input-&gt;post(<span class="string">'text'</span>)</div><div class="line">    );</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;db-&gt;insert(<span class="string">'news'</span>, $data);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>#数据校验<br>CodeIgniter官方给出的最佳实践三原则，原文照录如下：<br>1.Validate the data to ensure it confirms to the correct type, length, size, etc.<br>2.Filter data as if it were tainted.<br>3.Escape the data before submitting it into your database or outputting it to a browser.</p>
<p>#Cache使用方法<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">$this</span>-&gt;load-&gt;driver(<span class="string">'cache'</span>, <span class="keyword">array</span>(</div><div class="line">    <span class="string">'adapter'</span> =&gt; <span class="string">'apc'</span>,</div><div class="line">    <span class="string">'backup'</span>  =&gt; <span class="string">'file'</span></div><div class="line">));</div><div class="line"></div><div class="line"><span class="keyword">$this</span>-&gt;cache-&gt;get(<span class="string">'item'</span>);</div><div class="line"><span class="keyword">$this</span>-&gt;cache-&gt;save(<span class="string">'cache_item_id'</span>, <span class="string">'data_to_cache'</span>);</div></pre></td></tr></table></figure></p>
<p>也有不传adapter的写法：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">$this</span>-&gt;load-&gt;driver(<span class="string">'cache'</span>);</div><div class="line"><span class="keyword">$this</span>-&gt;cache-&gt;redis-&gt;save(<span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="number">10</span>);</div></pre></td></tr></table></figure></p>
<p>#Profile<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">$this</span>-&gt;benchmark-&gt;mark(<span class="string">'code_start'</span>);</div><div class="line"><span class="keyword">$this</span>-&gt;benchmark-&gt;mark(<span class="string">'code_end'</span>);</div><div class="line"></div><div class="line"><span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;benchmark-&gt;elapsed_time(<span class="string">'code_start'</span>, <span class="string">'code_end'</span>);</div><div class="line"></div><div class="line"><span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;benchmark-&gt;memory_usage();</div></pre></td></tr></table></figure></p>
<p>#一些实用函数<br>CI自带的，感觉以后可能会用到，留个印象，需要时随时可以查下文档备忘。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">$this</span>-&gt;load-&gt;helper(<span class="string">'date'</span>);</div><div class="line"><span class="keyword">echo</span> standard_date();</div><div class="line"><span class="keyword">echo</span> mysql_to_unix();</div><div class="line"><span class="keyword">echo</span> unix_to_human();</div><div class="line"><span class="keyword">echo</span> gmt_to_local();</div><div class="line"><span class="keyword">echo</span> unix_to_human();</div><div class="line"><span class="keyword">echo</span> timezone_menu();</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">$this</span>-&gt;load-&gt;helper(<span class="string">'text'</span>);</div><div class="line"><span class="keyword">$this</span>-&gt;load-&gt;helper(<span class="string">'inflector'</span>);</div><div class="line"><span class="keyword">echo</span> word_censor();</div><div class="line"><span class="keyword">echo</span> word_limiter();</div><div class="line"><span class="keyword">echo</span> underscore();</div><div class="line"><span class="keyword">echo</span> camelize();</div></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/PHP/">PHP</a><a href="/tags/CodeIgniter/">CodeIgniter</a></div><div class="post-nav"><a class="pre" href="/2015/05/26/给svn背景同学们的Git简介/">给svn背景同学们的Git简介</a><a class="next" href="/2015/05/08/七问/">七问</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://diaosj.info"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Tornado/" style="font-size: 15px;">Tornado</a> <a href="/tags/C/" style="font-size: 15px;">C++</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/Infobright/" style="font-size: 15px;">Infobright</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/CodeIgniter/" style="font-size: 15px;">CodeIgniter</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/足球/" style="font-size: 15px;">足球</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Lua/" style="font-size: 15px;">Lua</a> <a href="/tags/乱翻书/" style="font-size: 15px;">乱翻书</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/C/" style="font-size: 15px;">C</a> <a href="/tags/Yaf/" style="font-size: 15px;">Yaf</a> <a href="/tags/Laravel/" style="font-size: 15px;">Laravel</a> <a href="/tags/Yii/" style="font-size: 15px;">Yii</a> <a href="/tags/Zend/" style="font-size: 15px;">Zend</a> <a href="/tags/Perl/" style="font-size: 15px;">Perl</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Django/" style="font-size: 15px;">Django</a> <a href="/tags/数据结构/" style="font-size: 15px;">数据结构</a> <a href="/tags/Flask/" style="font-size: 15px;">Flask</a> <a href="/tags/Gevent/" style="font-size: 15px;">Gevent</a> <a href="/tags/Web-py/" style="font-size: 15px;">Web.py</a> <a href="/tags/Bottle/" style="font-size: 15px;">Bottle</a> <a href="/tags/Celery/" style="font-size: 15px;">Celery</a> <a href="/tags/Twisted/" style="font-size: 15px;">Twisted</a> <a href="/tags/NumPy/" style="font-size: 15px;">NumPy</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/SVN/" style="font-size: 15px;">SVN</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a> <a href="/tags/单车/" style="font-size: 15px;">单车</a> <a href="/tags/AWS/" style="font-size: 15px;">AWS</a> <a href="/tags/FastDFS/" style="font-size: 15px;">FastDFS</a> <a href="/tags/围棋/" style="font-size: 15px;">围棋</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/数学/" style="font-size: 15px;">数学</a> <a href="/tags/游戏/" style="font-size: 15px;">游戏</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/02/17/看球笔记-4/">看球笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/24/年会/">年会</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/22/RAID卡相关信息查询/">RAID卡相关信息查询</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/20/Nginx源码阅读/">Nginx源码阅读</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/18/jQuery源码阅读/">jQuery源码阅读</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/10/生日问题/">生日问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/06/衡量索引使用效率/">衡量索引使用效率</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/19/触发器的妙用一例/">触发器的妙用一例</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/13/MySQL配置文件模板/">MySQL配置文件模板</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/28/姜博的SQL题/">姜博的SQL题</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">山中日月长，云下饭藿香.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>